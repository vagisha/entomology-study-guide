<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entomology Flashcards</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; background: #2c3e50; color: #eee; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    h1 { margin-bottom: 10px; color: #74c69d; }
    .mode-toggle { margin-bottom: 20px; }
    .mode-toggle button { background: #333; color: #eee; }
    .mode-toggle button.active { background: #4ecca3; color: #1a1a2e; }
    .card { width: 100%; max-width: 500px; min-height: 600px; perspective: 1000px; cursor: pointer; margin-bottom: 20px; }
    .card-inner { width: 100%; height: 100%; min-height: 600px; transition: transform 0.6s; transform-style: preserve-3d; position: relative; }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-front, .card-back { position: absolute; width: 100%; min-height: 600px; backface-visibility: hidden; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center; }
    .card-front { background: linear-gradient(135deg, #34495e 0%, #5d6d7e 100%); }
    .card-back { background: linear-gradient(135deg, #52b788 0%, #74c69d 100%); transform: rotateY(180deg); color: #2c3e50; }
    .card-front.optional, .card-back.optional { border: 6px dashed #ffa500; }
    .insect-name { font-size: 1.6em; font-weight: bold; margin-bottom: 10px; }
    .answer-label { font-size: 0.9em; opacity: 0.8; margin-bottom: 5px; }
    .answer-value { font-size: 1.4em; font-weight: bold; margin-bottom: 15px; }
    .marks { font-size: 1em; line-height: 1.5; }
    .optional-badge {
      display: inline-block;
      background: #ffa500;
      color: #2c3e50;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75em;
      font-weight: bold;
      margin-left: 8px;
    }
    .card-links { margin-top: 15px; display: flex; gap: 10px; justify-content: center; }
    .card-links a { background: rgba(255,255,255,0.3); color: #2c3e50; padding: 8px 16px; text-decoration: none; border-radius: 6px; font-size: 0.85em; }
    .card-links a:hover { background: rgba(255,255,255,0.5); }
    .hint { font-size: 0.85em; opacity: 0.7; margin-top: 10px; }
    .img-container { width: 100%; height: 280px; background: rgba(255,255,255,0.2); border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; overflow: hidden; }
    .img-container img { width: 100%; height: 100%; object-fit: contain; }
    button { background: #74c69d; color: #2c3e50; border: none; padding: 12px 24px; font-size: 1em; border-radius: 8px; cursor: pointer; margin: 5px; }
    button:hover { background: #52b788; }
    .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .progress { margin-top: 15px; opacity: 0.7; }
    .loading { opacity: 0.6; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>üêõ Entomology Flashcards</h1>
  <div class="mode-toggle">
    <button onclick="window.location.href='browse.html'">Browse Insects</button>
  </div>
  
  <div style="text-align: center; margin-bottom: 15px;">
    <label style="color: #eee; cursor: pointer;">
      <input type="checkbox" id="include-optional" checked onchange="toggleOptional()">
      Include State/National Level (Optional)
    </label>
  </div>
  
  <div class="card" onclick="flipCard()">
    <div class="card-inner">
      <div class="card-front">
        <div class="img-container" id="front-img"><span class="loading">Loading...</span></div>
        <div class="insect-name" id="insect-name"></div>
        <div class="hint" id="hint">Click to reveal answer</div>
      </div>
      <div class="card-back">
        <div class="img-container" id="back-img"></div>
        <div class="answer-label" id="answer-label"></div>
        <div class="answer-value" id="answer-value"></div>
        <div class="marks" id="full-info"></div>
        <div class="card-links" id="card-links"></div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="prevCard()">‚Üê Previous</button>
    <button onclick="nextCard()">Next ‚Üí</button>
    <button onclick="shuffleCards()">Shuffle</button>
  </div>
  <div class="progress" id="progress"></div>

  <script>
    const insects = [
      // Protura (OPTIONAL - State/National only)
      { name: "Proturan", order: "Protura", family: "Protura", wiki: "Protura", marks: "Tiny, no antennae, no eyes, soil-dwelling", optional: true },
      
      // Diplura
      { name: "Dipluran", order: "Diplura", family: "Diplura", wiki: "Diplura", marks: "Two tail filaments, no eyes, soil-dwelling" },
      
      // Archaeognatha
      { name: "Bristletail", order: "Archaeognatha", family: "Archaeognatha", wiki: "Archaeognatha", marks: "Three tail filaments, arched body, jumping" },
      
      // Zygentoma
      { name: "Silverfish/Firebrat", order: "Zygentoma", family: "Zygentoma", wiki: "Zygentoma", marks: "Three tail filaments, flattened, scales, fast runner" },
      
      // Ephemeroptera
      { name: "Mayfly", order: "Ephemeroptera", family: "Ephemeridae", wiki: "Ephemeridae", marks: "Two or three long tails, upright wings, short adult life" },
      
      // Odonata
      { name: "Darner", order: "Odonata", family: "Aeshnidae", wiki: "Aeshnidae", marks: "Large dragonfly, strong flier, eyes meet on top" },
      { name: "Clubtail", order: "Odonata", family: "Gomphidae", wiki: "Gomphidae", marks: "Eyes separated, clubbed abdomen tip", optional: true },
      { name: "Skimmer", order: "Odonata", family: "Libellulidae", wiki: "Libellulidae", marks: "Perch on vegetation, colorful, broad abdomen" },
      { name: "Spread-wing Damselfly", order: "Odonata", family: "Lestidae", wiki: "Lestidae", marks: "Wings held partially open at rest, metallic" },
      { name: "Narrow-winged Damselfly", order: "Odonata", family: "Coenagrionidae", wiki: "Coenagrionidae", marks: "Delicate, wings held together over back" },
      
      // Blattodea
      { name: "Termite", order: "Blattodea", family: "Termitidae", wiki: "Termitidae", marks: "Social, soft-bodied, feed on wood" },
      { name: "Household Roach", order: "Blattodea", family: "Blattidae", wiki: "Blattidae", marks: "Flattened, long antennae, fast runner" },
      { name: "Brown-hooded Roach", order: "Blattodea", family: "Cryptocercidae", wiki: "Cryptocercidae", marks: "Live in rotting wood, social behavior", optional: true },
      
      // Mantodea
      { name: "Mantis", order: "Mantodea", family: "Mantidae", wiki: "Mantidae", marks: "Raptorial front legs, triangular head, predaceous" },
      
      // Embioptera
      { name: "Webspinner", order: "Embioptera", family: "Embioptera", wiki: "Embioptera", marks: "Silk glands in front tarsi, live in silk tunnels" },
      
      // Dermaptera
      { name: "Earwig", order: "Dermaptera", family: "Dermaptera", wiki: "Dermaptera", marks: "Forceps-like cerci, short wings" },
      
      // Plecoptera
      { name: "Stonefly", order: "Plecoptera", family: "Perlidae", wiki: "Perlidae", marks: "Two tail filaments, wings fold flat, clean water indicator" },
      
      // Orthoptera
      { name: "Pygmy Grasshopper", order: "Orthoptera", family: "Tetrigidae", wiki: "Tetrigidae", marks: "Very small, pronotum extends over abdomen", optional: true },
      { name: "Short-horned Grasshopper", order: "Orthoptera", family: "Acrididae", wiki: "Acrididae", marks: "Short antennae, enlarged hind legs, herbivorous" },
      { name: "Katydid", order: "Orthoptera", family: "Tettigoniidae", wiki: "Tettigoniidae", marks: "Long antennae, leaf-like wings, sing at night" },
      { name: "Camel Cricket", order: "Orthoptera", family: "Rhaphidophoridae", wiki: "Rhaphidophoridae", marks: "Humpbacked, long antennae, no wings" },
      { name: "Cricket", order: "Orthoptera", family: "Gryllidae", wiki: "Gryllidae", marks: "Long antennae, chirping song, omnivorous" },
      { name: "Mole Cricket", order: "Orthoptera", family: "Gryllotalpidae", wiki: "Gryllotalpidae", marks: "Fossorial front legs, cylindrical body, burrow" },
      
      // Phasmatodea
      { name: "Common Walkingstick", order: "Phasmatodea", family: "Diapheromeridae", wiki: "Diapheromeridae", marks: "Twig-like camouflage, slow moving, herbivorous" },
      
      // Psocodea
      { name: "Book/Bark Lice", order: "Psocodea", family: "Psocodea", wiki: "Psocodea", marks: "Small, soft-bodied, feed on mold and organic matter" },
      
      // Hemiptera
      { name: "Toad Bug", order: "Hemiptera", family: "Gelastocoridae", wiki: "Gelastocoridae", marks: "Warty appearance, hop like toads, predaceous", optional: true },
      { name: "Water Strider", order: "Hemiptera", family: "Gerridae", wiki: "Gerridae", marks: "Long legs, skate on water surface" },
      { name: "Bed Bug", order: "Hemiptera", family: "Cimicidae", wiki: "Cimicidae", marks: "Flat, oval, wingless, blood feeders" },
      { name: "Plant Bug", order: "Hemiptera", family: "Miridae", wiki: "Miridae", marks: "Soft-bodied, many feed on plants", optional: true },
      { name: "Assassin Bug", order: "Hemiptera", family: "Reduviidae", wiki: "Reduviidae", marks: "Narrow head, curved beak, predaceous" },
      { name: "Metallic Shield Bug", order: "Hemiptera", family: "Scutelleridae", wiki: "Scutelleridae", marks: "Large scutellum covers abdomen, often metallic" },
      { name: "Lace Bug", order: "Hemiptera", family: "Tingidae", wiki: "Tingidae", marks: "Lacy wings and pronotum, small, plant feeders", optional: true },
      { name: "Seed Bug", order: "Hemiptera", family: "Lygaeidae", wiki: "Lygaeidae", marks: "Elongated, many feed on seeds", optional: true },
      { name: "Leaf-footed Bug", order: "Hemiptera", family: "Coreidae", wiki: "Coreidae", marks: "Leaf-like expansions on hind legs" },
      { name: "Stink Bug", order: "Hemiptera", family: "Pentatomidae", wiki: "Pentatomidae", marks: "Shield-shaped, scent glands, piercing mouthparts" },
      { name: "Cicada", order: "Hemiptera", family: "Cicadidae", wiki: "Cicadidae", marks: "Large eyes, transparent wings, loud buzzing call" },
      { name: "Treehopper", order: "Hemiptera", family: "Membracidae", wiki: "Membracidae", marks: "Enlarged pronotum, often bizarre shapes" },
      { name: "Froghopper", order: "Hemiptera", family: "Cercopidae", wiki: "Cercopidae", marks: "Stout, jump well, nymphs produce spittle" },
      { name: "Leafhopper", order: "Hemiptera", family: "Cicadellidae", wiki: "Cicadellidae", marks: "Slender, jump readily, many plant pests" },
      { name: "Planthopper", order: "Hemiptera", family: "Fulgoridae", wiki: "Fulgoridae", marks: "Antennae below eyes, many jump" },
      { name: "Aphid", order: "Hemiptera", family: "Aphididae", wiki: "Aphididae", marks: "Soft-bodied, cornicles on abdomen, plant feeders" },
      { name: "Mealybug", order: "Hemiptera", family: "Pseudococcidae", wiki: "Pseudococcidae", marks: "Covered with white waxy powder" },
      { name: "Soft Scale", order: "Hemiptera", family: "Coccidae", wiki: "Coccidae", marks: "Females lack wings, covered by waxy secretion" },
      { name: "Water Boatman", order: "Hemiptera", family: "Corixidae", wiki: "Corixidae", marks: "Aquatic, swim with oar-like legs, feed on algae" },
      { name: "Backswimmer", order: "Hemiptera", family: "Notonectidae", wiki: "Notonectidae", marks: "Swim upside-down, predaceous, can bite" },
      { name: "Giant Water Bug", order: "Hemiptera", family: "Belostomatidae", wiki: "Belostomatidae", marks: "Large, aquatic, powerful predators, can bite" },
      { name: "Waterscorpion", order: "Hemiptera", family: "Nepidae", wiki: "Nepidae", marks: "Long breathing tube, raptorial front legs", optional: true },
      
      // Thysanoptera
      { name: "Thrips", order: "Thysanoptera", family: "Thripidae", wiki: "Thripidae", marks: "Tiny, fringed wings, rasping mouthparts" },
      
      // Megaloptera
      { name: "Dobsonfly", order: "Megaloptera", family: "Corydalidae", wiki: "Corydalidae", marks: "Large mandibles in males, aquatic larvae" },
      
      // Neuroptera
      { name: "Green Lacewing", order: "Neuroptera", family: "Chrysopidae", wiki: "Chrysopidae", marks: "Delicate green, golden eyes, net-veined wings" },
      { name: "Antlion", order: "Neuroptera", family: "Myrmeleontidae", wiki: "Myrmeleontidae", marks: "Larvae dig pit traps, adults resemble damselflies" },
      
      // Coleoptera - Beetles
      { name: "Ground and Tiger Beetle", wiki: "Carabidae", order: "Coleoptera", family: "Carabidae", marks: "Long legs, fast runners, predaceous, often metallic colors" },
      { name: "Predaceous Diving Beetle", wiki: "Dytiscidae", order: "Coleoptera", family: "Dytiscidae", marks: "Streamlined, aquatic, hind legs flattened for swimming" },
      { name: "Whirligig Beetle", wiki: "Gyrinidae", order: "Coleoptera", family: "Gyrinidae", marks: "Divided eyes, swim in circles on water surface, short antennae" },
      { name: "Water Scavenger Beetle", wiki: "Hydrophilidae", order: "Coleoptera", family: "Hydrophilidae", marks: "Aquatic, long maxillary palps, convex body" },
      { name: "Water Penny Beetle", wiki: "Psephenidae", order: "Coleoptera", family: "Psephenidae", marks: "Larvae flat and round like pennies, found in streams" },
      { name: "Riffle Beetle", wiki: "Elmidae", order: "Coleoptera", family: "Elmidae", marks: "Small, aquatic, found in fast-flowing water" },
      { name: "Hister Beetle", wiki: "Histeridae", order: "Coleoptera", family: "Histeridae", marks: "Compact, shiny black, truncated elytra, predaceous", optional: true },
      { name: "Rove Beetle", wiki: "Staphylinidae", order: "Coleoptera", family: "Staphylinidae", marks: "Short elytra exposing abdomen, flexible body" },
      { name: "Carrion Beetle", wiki: "Silphidae", order: "Coleoptera", family: "Silphidae", marks: "Flattened, feed on carrion, some bury small animals", optional: true },
      { name: "Stag Beetle", wiki: "Lucanidae", order: "Coleoptera", family: "Lucanidae", marks: "Large mandibles in males, larvae in rotting wood" },
      { name: "Bess Beetle", wiki: "Passalidae", order: "Coleoptera", family: "Passalidae", marks: "Shiny black, horn on head, social, live in rotting logs" },
      { name: "Dung Beetle", wiki: "Scarabaeidae", order: "Coleoptera", family: "Scarabaeidae", marks: "Stout body, lamellate antennae, many roll dung balls" },
      { name: "Metallic Wood-boring/Jewel Beetle", wiki: "Buprestidae", order: "Coleoptera", family: "Buprestidae", marks: "Metallic colors, bullet-shaped, larvae bore in wood" },
      { name: "Click Beetle", wiki: "Elateridae", order: "Coleoptera", family: "Elateridae", marks: "Can flip into air with clicking sound, elongated body", optional: true },
      { name: "Firefly", wiki: "Lampyridae", order: "Coleoptera", family: "Lampyridae", marks: "Bioluminescent, soft-bodied, light organs on abdomen", optional: true },
      { name: "Soldier Beetle", wiki: "Cantharidae", order: "Coleoptera", family: "Cantharidae", marks: "Soft elytra, elongated, often on flowers, predaceous" },
      { name: "Net-winged Beetle", wiki: "Lycidae", order: "Coleoptera", family: "Lycidae", marks: "Soft-bodied, net-like wing venation, often brightly colored", optional: true },
      { name: "Checkered Beetle", wiki: "Cleridae", order: "Coleoptera", family: "Cleridae", marks: "Hairy, often colorful patterns, predaceous", optional: true },
      { name: "Lady-bird Beetle (Ladybug)", wiki: "Coccinellidae", order: "Coleoptera", family: "Coccinellidae", marks: "Round dome shape, often red/orange with spots, beneficial predator" },
      { name: "Darkling Beetle", wiki: "Tenebrionidae", order: "Coleoptera", family: "Tenebrionidae", marks: "Usually black, hard-bodied, many desert species" },
      { name: "Blister Beetle", wiki: "Meloidae", order: "Coleoptera", family: "Meloidae", marks: "Soft-bodied, produce blistering agent, head wider than pronotum" },
      { name: "Long-horned Beetle", wiki: "Cerambycidae", order: "Coleoptera", family: "Cerambycidae", marks: "Very long antennae, larvae bore in wood" },
      { name: "Leaf Beetle", wiki: "Chrysomelidae", order: "Coleoptera", family: "Chrysomelidae", marks: "Small, oval, often colorful, feed on plants" },
      { name: "Weevil", wiki: "Curculionidae", order: "Coleoptera", family: "Curculionidae", marks: "Elongated snout, elbowed antennae, plant feeders" },
      { name: "Flat Bark Beetle", wiki: "Cucujidae", order: "Coleoptera", family: "Cucujidae", marks: "Extremely flattened, live under bark" },
      
      // Mecoptera (OPTIONAL - entire order)
      { name: "Snow Scorpionfly", order: "Mecoptera", family: "Boreidae", wiki: "Boreidae", marks: "Small, wingless, active in winter", optional: true },
      { name: "Common Scorpionfly", order: "Mecoptera", family: "Panorpidae", wiki: "Panorpidae", marks: "Elongated face, males have curved tail tip", optional: true },
      
      // Raphidioptera
      { name: "Raphidiid Snakefly", order: "Raphidioptera", family: "Raphidiidae", wiki: "Raphidiidae", marks: "Long prothorax, head mobile, predaceous" },
      
      // Siphonaptera
      { name: "Flea", order: "Siphonaptera", family: "Siphonaptera", wiki: "Siphonaptera", marks: "Laterally compressed, jumping legs, blood feeders" },
      
      // Diptera - True Flies
      { name: "Crane Fly", wiki: "Tipulidae", order: "Diptera", family: "Tipulidae", marks: "Very long legs, mosquito-like but larger, V-shaped suture" },
      { name: "Geometer Moth", wiki: "Geometridae", order: "Lepidoptera", family: "Geometridae", marks: "Thin body, wings held flat, larvae are inchworms" },
      { name: "Tent Caterpillar/Lappet Moth", wiki: "Lasiocampidae", order: "Lepidoptera", family: "Lasiocampidae", marks: "Stout, hairy, larvae build silk tents", optional: true },
      { name: "Snout Moth", wiki: "Pyralidae", order: "Lepidoptera", family: "Pyralidae", marks: "Elongated labial palps form snout, triangular at rest", optional: true },
      { name: "Giant Silkworm Moth", wiki: "Saturniidae", order: "Lepidoptera", family: "Saturniidae", marks: "Large, eyespots on wings, feathery antennae" },
      { name: "Sphinx Moth", wiki: "Sphingidae", order: "Lepidoptera", family: "Sphingidae", marks: "Heavy body, narrow wings, fast fliers, long proboscis" },
      { name: "Tiger Moth", wiki: "Erebidae", order: "Lepidoptera", family: "Erebidae", marks: "Often colorful, hairy, many are toxic" },
      { name: "Owlet Moth", wiki: "Noctuidae", order: "Lepidoptera", family: "Noctuidae", marks: "Dull colored, stout body, most are nocturnal" },
      { name: "Clearwing Moth", wiki: "Sesiidae", order: "Lepidoptera", family: "Sesiidae", marks: "Transparent wings, wasp mimics, day-flying" },
      { name: "Tortrix Moth", wiki: "Tortricidae", order: "Lepidoptera", family: "Tortricidae", marks: "Small, bell-shaped at rest, larvae roll leaves", optional: true },
      { name: "Skipper", wiki: "Hesperiidae", order: "Lepidoptera", family: "Hesperiidae", marks: "Stout body, hooked antennae, fast erratic flight" },
      { name: "Swallowtail", wiki: "Papilionidae", order: "Lepidoptera", family: "Papilionidae", marks: "Large, often with tail extensions, colorful" },
      { name: "White or Sulfur", wiki: "Pieridae", order: "Lepidoptera", family: "Pieridae", marks: "White, yellow, or orange, medium-sized" },
      { name: "Hairstreak or Blue", wiki: "Lycaenidae", order: "Lepidoptera", family: "Lycaenidae", marks: "Small, delicate, often with hair-like tails" },
      { name: "Brush-footed Butterfly", wiki: "Nymphalidae", order: "Lepidoptera", family: "Nymphalidae", marks: "Diverse family, often colorful, reduced forelegs" },
      
      // Hymenoptera - Bees, Wasps, Ants
      { name: "Common Sawfly", wiki: "Tenthredinidae", order: "Hymenoptera", family: "Tenthredinidae", marks: "No wasp waist, larvae resemble caterpillars" },
      { name: "Horntail", wiki: "Siricidae", order: "Hymenoptera", family: "Siricidae", marks: "Large, cylindrical, horn-like ovipositor", optional: true },
      { name: "Ichneumon", wiki: "Ichneumonidae", order: "Hymenoptera", family: "Ichneumonidae", marks: "Long antennae, long ovipositor, parasitic" },
      { name: "Gall Wasp", wiki: "Cynipidae", order: "Hymenoptera", family: "Cynipidae", marks: "Small, humpbacked, induce plant galls", optional: true },
      { name: "Velvet Ant", wiki: "Mutillidae", order: "Hymenoptera", family: "Mutillidae", marks: "Wingless females, dense hair, painful sting" },
      { name: "Ant", wiki: "Formicidae", order: "Hymenoptera", family: "Formicidae", marks: "Elbowed antennae, social, distinct node on petiole" },
      { name: "Paper Wasp", wiki: "Vespidae", order: "Hymenoptera", family: "Vespidae", marks: "Narrow waist, long legs, builds paper nests" },
      { name: "Thread-waisted Wasp", wiki: "Sphecidae", order: "Hymenoptera", family: "Sphecidae", marks: "Very narrow waist, solitary hunters" },
      { name: "Braconid Wasp", wiki: "Braconidae", order: "Hymenoptera", family: "Braconidae", marks: "Small, parasitic, short ovipositor", optional: true },
      { name: "Sweat Bee", wiki: "Halictidae", order: "Hymenoptera", family: "Halictidae", marks: "Small, often metallic, attracted to perspiration" },
      { name: "Leaf Cutter Bee", wiki: "Megachilidae", order: "Hymenoptera", family: "Megachilidae", marks: "Cut circular pieces from leaves, pollen on abdomen" },
      { name: "Honey Bee", wiki: "Apidae", order: "Hymenoptera", family: "Apidae", marks: "Golden-brown with stripes, pollen baskets on legs, social" },
      
      // Diptera - True Flies
      { name: "Crane Fly", wiki: "Tipulidae", order: "Diptera", family: "Tipulidae", marks: "Very long legs, mosquito-like but larger, V-shaped suture" },
      { name: "Mosquito", wiki: "Culicidae", order: "Diptera", family: "Culicidae", marks: "Long proboscis, scaled wings, aquatic larvae" },
      { name: "Midge", wiki: "Chironomidae", order: "Diptera", family: "Chironomidae", marks: "Small, mosquito-like, no proboscis, aquatic larvae" },
      { name: "Black Fly", wiki: "Simuliidae", order: "Diptera", family: "Simuliidae", marks: "Small, humpbacked, short antennae, blood feeders", optional: true },
      { name: "Soldier Fly", wiki: "Stratiomyidae", order: "Diptera", family: "Stratiomyidae", marks: "Flattened, often colorful, slow flying" },
      { name: "Horse Fly", wiki: "Tabanidae", order: "Diptera", family: "Tabanidae", marks: "Large, stout, large eyes, females blood feeders" },
      { name: "Robber Fly", wiki: "Asilidae", order: "Diptera", family: "Asilidae", marks: "Bearded face, predaceous, catch prey in flight" },
      { name: "Bee Fly", wiki: "Bombyliidae", order: "Diptera", family: "Bombyliidae", marks: "Fuzzy, bee mimics, long proboscis, hover" },
      { name: "Hover/Flower Fly", wiki: "Syrphidae", order: "Diptera", family: "Syrphidae", marks: "Wasp/bee mimics, hover in place, beneficial" },
      { name: "Fruit Fly, Husk Fly", wiki: "Tephritidae", order: "Diptera", family: "Tephritidae", marks: "Patterned wings, many are crop pests", optional: true },
      { name: "Pomace Fly, Fruit/Vinegar Fly", wiki: "Drosophilidae", order: "Diptera", family: "Drosophilidae", marks: "Small, red eyes, attracted to fermenting fruit" },
      { name: "House Fly", wiki: "Muscidae", order: "Diptera", family: "Muscidae", marks: "Single pair wings, large eyes, sponging mouthparts" },
      { name: "Blow Fly", wiki: "Calliphoridae", order: "Diptera", family: "Calliphoridae", marks: "Metallic blue or green, bristly, on carrion" },
      { name: "Tachinid Fly", wiki: "Tachinidae", order: "Diptera", family: "Tachinidae", marks: "Bristly, parasitic on other insects", optional: true },
      { name: "Botfly", wiki: "Oestridae", order: "Diptera", family: "Oestridae", marks: "Stout, hairy, parasitic on mammals", optional: true },
      
      // Hemiptera - True Bugs
      { name: "Toad Bug", wiki: "Gelastocoridae", order: "Hemiptera", family: "Gelastocoridae", marks: "Warty appearance, hop like toads, predaceous", optional: true },
      { name: "Water Strider", wiki: "Gerridae", order: "Hemiptera", family: "Gerridae", marks: "Long legs, skate on water surface" },
      { name: "Bed Bug", wiki: "Cimicidae", order: "Hemiptera", family: "Cimicidae", marks: "Flat, oval, wingless, blood feeders" },
      { name: "Plant Bug", wiki: "Miridae", order: "Hemiptera", family: "Miridae", marks: "Soft-bodied, many feed on plants", optional: true },
      { name: "Assassin Bug", wiki: "Reduviidae", order: "Hemiptera", family: "Reduviidae", marks: "Narrow head, curved beak, predaceous" },
      { name: "Metallic Shield Bug", wiki: "Scutelleridae", order: "Hemiptera", family: "Scutelleridae", marks: "Large scutellum covers abdomen, often metallic" },
      { name: "Lace Bug", wiki: "Tingidae", order: "Hemiptera", family: "Tingidae", marks: "Lacy wings and pronotum, small, plant feeders", optional: true },
      { name: "Seed Bug", wiki: "Lygaeidae", order: "Hemiptera", family: "Lygaeidae", marks: "Elongated, many feed on seeds", optional: true },
      { name: "Leaf-footed Bug", wiki: "Coreidae", order: "Hemiptera", family: "Coreidae", marks: "Leaf-like expansions on hind legs" },
      { name: "Stink Bug", wiki: "Pentatomidae", order: "Hemiptera", family: "Pentatomidae", marks: "Shield-shaped, scent glands, piercing mouthparts" },
      { name: "Cicada", wiki: "Cicadidae", order: "Hemiptera", family: "Cicadidae", marks: "Large eyes, transparent wings, loud buzzing call" },
      { name: "Treehopper", wiki: "Membracidae", order: "Hemiptera", family: "Membracidae", marks: "Enlarged pronotum, often bizarre shapes" },
      { name: "Froghopper", wiki: "Cercopidae", order: "Hemiptera", family: "Cercopidae", marks: "Stout, jump well, nymphs produce spittle" },
      { name: "Leafhopper", wiki: "Cicadellidae", order: "Hemiptera", family: "Cicadellidae", marks: "Slender, jump readily, many plant pests" },
      { name: "Planthopper", wiki: "Fulgoridae", order: "Hemiptera", family: "Fulgoridae", marks: "Antennae below eyes, many jump" },
      { name: "Aphid", wiki: "Aphididae", order: "Hemiptera", family: "Aphididae", marks: "Soft-bodied, cornicles on abdomen, plant feeders" },
      { name: "Mealybug", wiki: "Pseudococcidae", order: "Hemiptera", family: "Pseudococcidae", marks: "Covered with white waxy powder" },
      { name: "Soft Scale", wiki: "Coccidae", order: "Hemiptera", family: "Coccidae", marks: "Females lack wings, covered by waxy secretion" },
      
      // Orthoptera - Grasshoppers and Crickets
      { name: "Pygmy Grasshopper", wiki: "Tetrigidae", order: "Orthoptera", family: "Tetrigidae", marks: "Very small, pronotum extends over abdomen", optional: true },
      { name: "Short-horned Grasshopper", wiki: "Acrididae", order: "Orthoptera", family: "Acrididae", marks: "Short antennae, enlarged hind legs, herbivorous" },
      { name: "Katydid", wiki: "Tettigoniidae", order: "Orthoptera", family: "Tettigoniidae", marks: "Long antennae, leaf-like wings, sing at night" },
      { name: "Camel Cricket", wiki: "Rhaphidophoridae", order: "Orthoptera", family: "Rhaphidophoridae", marks: "Humpbacked, long antennae, no wings" },
      { name: "Cricket", wiki: "Gryllidae", order: "Orthoptera", family: "Gryllidae", marks: "Long antennae, chirping song, omnivorous" },
      { name: "Mole Cricket", wiki: "Gryllotalpidae", order: "Orthoptera", family: "Gryllotalpidae", marks: "Fossorial front legs, cylindrical body, burrow" },
      
      // Other Orders
      { name: "Walkingstick", wiki: "Diapheromeridae", order: "Phasmatodea", family: "Diapheromeridae", marks: "Twig-like camouflage, slow moving, herbivorous" },
      { name: "Water Boatman", wiki: "Corixidae", order: "Hemiptera", family: "Corixidae", marks: "Aquatic, swim with oar-like legs, feed on algae" },
      { name: "Backswimmer", wiki: "Notonectidae", order: "Hemiptera", family: "Notonectidae", marks: "Swim upside-down, predaceous, can bite" },
      { name: "Giant Water Bug", wiki: "Belostomatidae", order: "Hemiptera", family: "Belostomatidae", marks: "Large, aquatic, powerful predators, can bite" },
      { name: "Waterscorpion", wiki: "Nepidae", order: "Hemiptera", family: "Nepidae", marks: "Long breathing tube, raptorial front legs", optional: true },
      { name: "Termite", wiki: "Termitidae", order: "Blattodea", family: "Termitidae", marks: "Social, soft-bodied, feed on wood" },
      { name: "Household Roach", wiki: "Blattidae", order: "Blattodea", family: "Blattidae", marks: "Flattened, long antennae, fast runner" },
      { name: "Brown-hooded Roach", wiki: "Cryptocercidae", order: "Blattodea", family: "Cryptocercidae", marks: "Live in rotting wood, social behavior", optional: true },
      { name: "Dobsonfly", wiki: "Corydalidae", order: "Megaloptera", family: "Corydalidae", marks: "Large mandibles in males, aquatic larvae" },
      { name: "Green Lacewing", wiki: "Chrysopidae", order: "Neuroptera", family: "Chrysopidae", marks: "Delicate green, golden eyes, net-veined wings" },
      { name: "Antlion", wiki: "Myrmeleontidae", order: "Neuroptera", family: "Myrmeleontidae", marks: "Larvae dig pit traps, adults resemble damselflies" },
      { name: "Darner", wiki: "Aeshnidae", order: "Odonata", family: "Aeshnidae", marks: "Large dragonfly, strong flier, eyes meet on top" },
      { name: "Clubtail", wiki: "Gomphidae", order: "Odonata", family: "Gomphidae", marks: "Eyes separated, clubbed abdomen tip", optional: true },
      { name: "Skimmer", wiki: "Libellulidae", order: "Odonata", family: "Libellulidae", marks: "Perch on vegetation, colorful, broad abdomen" },
      { name: "Spread-wing Damselfly", wiki: "Lestidae", order: "Odonata", family: "Lestidae", marks: "Wings held partially open at rest, metallic" },
      { name: "Narrow-winged Damselfly", wiki: "Coenagrionidae", order: "Odonata", family: "Coenagrionidae", marks: "Delicate, wings held together over back" },
      { name: "Mayfly", wiki: "Ephemeridae", order: "Ephemeroptera", family: "Ephemeridae", marks: "Two or three long tails, upright wings, short adult life" },
      { name: "Stonefly", wiki: "Perlidae", order: "Plecoptera", family: "Perlidae", marks: "Two tail filaments, wings fold flat, clean water indicator" },
      { name: "Snakefly", wiki: "Raphidiidae", order: "Raphidioptera", family: "Raphidiidae", marks: "Long prothorax, head mobile, predaceous" },
      { name: "Snow Scorpionfly", wiki: "Boreidae", order: "Mecoptera", family: "Boreidae", marks: "Small, wingless, active in winter", optional: true },
      { name: "Common Scorpionfly", wiki: "Panorpidae", order: "Mecoptera", family: "Panorpidae", marks: "Elongated face, males have curved tail tip", optional: true },
      { name: "Thrips", wiki: "Thripidae", order: "Thysanoptera", family: "Thripidae", marks: "Tiny, fringed wings, rasping mouthparts" },
      { name: "Caddisfly", wiki: "Limnephilidae", order: "Trichoptera", family: "Limnephilidae", marks: "Hairy wings, moth-like, larvae build cases" },
      { name: "Hardback Tick", wiki: "Ixodidae", order: "Acari", family: "Ixodidae", marks: "Hard dorsal shield, blood feeders, disease vectors" },
    ];

    const imageCache = {};

    let deck = [], currentIndex = 0;

    function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }
    function flipCard() { document.querySelector('.card').classList.toggle('flipped'); }

    async function fetchImage(insect) {
      const localPath = `images/${insect.order}/${insect.family}/specimen.jpg`;
      
      // Try local image first
      return new Promise((resolve) => {
        const localImg = new Image();
        
        localImg.onload = function() {
          resolve(localPath);
        };
        
        localImg.onerror = async function() {
          // Local image not found, try Wikipedia
          if (imageCache[insect.wiki]) {
            resolve(imageCache[insect.wiki]);
            return;
          }
          
          try {
            const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(insect.wiki)}`;
            const res = await fetch(url);
            const data = await res.json();
            const imgUrl = data.thumbnail?.source || '';
            imageCache[insect.wiki] = imgUrl;
            resolve(imgUrl);
          } catch {
            resolve('');
          }
        };
        
        localImg.src = localPath;
      });
    }

    function buildDeck() {
      deck = [];
      const includeOptional = document.getElementById('include-optional').checked;
      
      insects.forEach(insect => {
        // Skip optional insects if checkbox is unchecked
        if (insect.optional && !includeOptional) return;
        
        deck.push({ insect });
      });
      shuffle(deck);
    }
    
    function toggleOptional() {
      buildDeck();
      currentIndex = 0;
      showCard();
    }

    async function showCard() {
      const item = deck[currentIndex];
      const insect = item.insect;

      document.getElementById('front-img').innerHTML = '<span class="loading">Loading...</span>';
      document.getElementById('back-img').innerHTML = '';
      document.getElementById('insect-name').textContent = '';
      document.getElementById('answer-label').textContent = '';
      document.getElementById('answer-value').textContent = insect.name;
      
      // Add or remove optional class based on insect
      const frontCard = document.querySelector('.card-front');
      const backCard = document.querySelector('.card-back');
      if (insect.optional) {
        frontCard.classList.add('optional');
        backCard.classList.add('optional');
      } else {
        frontCard.classList.remove('optional');
        backCard.classList.remove('optional');
      }
      
      // Always show Order and Family with consistent styling
      let details = `<strong>Order:</strong> ${insect.order}<br>`;
      details += `<strong>Family:</strong> ${insect.family}`;
      if (insect.optional) {
        details += ` <span class="optional-badge">‚≠ê State/National</span>`;
      }
      details += `<br><br><strong>Distinguishing Marks:</strong> ${insect.marks}`;
      
      document.getElementById('full-info').innerHTML = details;
      document.getElementById('card-links').innerHTML = `
        <a href="https://en.wikipedia.org/wiki/${insect.wiki}" target="_blank">Wikipedia</a>
        <a href="https://genent.cals.ncsu.edu/insect-identification/order-${insect.order.toLowerCase()}/family-${insect.family.toLowerCase()}/" target="_blank">NC State</a>
      `;
      document.getElementById('progress').textContent = `Card ${currentIndex + 1} of ${deck.length}`;
      document.querySelector('.card').classList.remove('flipped');

      const imgUrl = await fetchImage(insect);
      const imgHtml = imgUrl ? `<img src="${imgUrl}" alt="${insect.name}">` : 'No image';
      document.getElementById('front-img').innerHTML = imgHtml;
      document.getElementById('back-img').innerHTML = imgHtml;
    }

    function nextCard() { currentIndex = (currentIndex + 1) % deck.length; showCard(); }
    function prevCard() { currentIndex = (currentIndex - 1 + deck.length) % deck.length; showCard(); }
    function shuffleCards() { buildDeck(); currentIndex = 0; showCard(); }

    buildDeck();
    showCard();
  </script>
</body>
</html>
